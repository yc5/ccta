<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>電算中心實習生工作日誌格式轉換</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
        integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
    <style>
        textarea {
            width: 100%;
            resize: vertical;
        }

        button {
            width: 100%;
        }
    </style>
</head>

<body>
    <div class="container mt-3">
        <h1>電算中心實習生工作日誌格式轉換</h1>
        <form action="">
            <div class="row">
                <div class="col-md-8">
                    <div class="form-froup mb-3">
                        <label for="a">Evernote</label>
                        <textarea class="form-control" name="a" id="a" cols="30" rows="20">
當日編號：01
設備卡號：045678
聯絡時間：8:15
申請單位：航海系
申請人(分機)：汪先生(#7024)
服務性質： [] 到場處理    [x] 電話線上處理(含遠端處理)
服務類別： [] 硬體　 [x] 軟體　 [] 網路　 [] 郵件　 [] 重灌　 [] 中毒　 [] 無線　 [] 諮詢　 [] 印表機 　 [] 其他
處理結果： [x] 已完成　 [] 未完成
服務滿意度： [] 1  [] 2  [] 3  [] 4  [x] 5  
服務時間：10 分
作業系統：
問題簡述：
    1. Outlook 啟動時會顯示「資源已用盡」相關錯誤訊息，無法順利開啟。

解決方法：
    1. 使用者因近期遠端辦公，皆未關機。
    2. 請使用者嘗試重開機。
    3. 順利啟動。

FAQ選項： [] 已存在FAQ　 [] 已建立FAQ　 [x] 可能以後不會發生


當日編號：02
設備卡號：105897
聯絡時間：8:30
申請單位：寶可系
申請人(分機)：卡比獸
服務性質： [x] 到場處理    [] 電話線上處理(含遠端處理)
服務類別： [] 硬體　 [x] 軟體　 [] 網路　 [] 郵件　 [] 重灌　 [] 中毒　 [] 無線　 [] 諮詢　 [] 印表機 　 [] 其他
處理結果： [x] 已完成　 [] 未完成
服務滿意度： [] 1  [] 2  [] 3  [] 4  [x] 5  
服務時間：30 分
作業系統：
問題簡述：
    1. 使用者希望將大量聯絡人資料從 Excel 格式匯入到 Webmail。

解決方法：
    1. 以 Webmail 匯出 Microsoft Outlook 中文版 CSV 2013 格式範本。
    2. 在 Excel 將對應資料複製進去。
    3. 處理各欄位格式問題。
    4. 新增一通訊錄目錄。
    5. 匯入 CSV 檔。
    6. 因使用者希望能親自操作並學會，故花費較長時間教學。
    7. 使用者表示相當感謝。

FAQ選項： [] 已存在FAQ　 [] 已建立FAQ　 [x] 可能以後不會發生


當日編號：03
設備卡號：345872
聯絡時間：9:56
申請單位：語言中心
申請人(分機)：泡芙小姐(#3456)
服務性質： [x] 到場處理    [] 電話線上處理(含遠端處理)
服務類別： [] 硬體　 [] 軟體　 [] 網路　 [] 郵件　 [] 重灌　 [] 中毒　 [] 無線　 [] 諮詢　 [x] 印表機 　 [] 其他
處理結果： [x] 已完成　 [] 未完成
服務滿意度： [] 1  [] 2  [] 3  [] 4  [x] 5  
服務時間：12 分
作業系統：
問題簡述：
    1. 校園軟體無法授權。

解決方法：
    1. 到場與使用者確認問題並非無法透過 KMS 認證。
    2. 重新定義使用者問題為：無法登入校園授權軟體系統。
    3. 確認使用者可以登入校務資訊系統。
    4. 回報系統組(僅有系統組同仁有此權限，TA無法協助處理。)系統問題。
    5. 系統組回復，依據人事室資料，老師目前身分為「退休教師」，新身分「兼任老師」為111年2月才開始，故無法登入是正常的。
    6. 使用者表示指導學生實際截止日已延至10/31，目前仍有一指導研究生，而今已無法登入，系統登入原則與實際情形有落差，給人感覺不好。

FAQ選項： [] 已存在FAQ　 [] 已建立FAQ　 [x] 可能以後不會發生


當日編號：04
設備卡號：056941
聯絡時間：13:18
申請單位：主計室
申請人(分機)：魯夫先生(#5487)
服務性質： [] 到場處理    [x] 電話線上處理(含遠端處理)
服務類別： [] 硬體　 [] 軟體　 [] 網路　 [x] 郵件　 [] 重灌　 [] 中毒　 [] 無線　 [] 諮詢　 [] 印表機 　 [] 其他
處理結果： [x] 已完成　 [] 未完成
服務滿意度： [] 1  [] 2  [] 3  [] 4  [x] 5  
服務時間：120 分
作業系統：
問題簡述：
    1. 大宗郵件寄出後會收到收件人無法收件的郵件。

解決方法：
    1. 檢查大宗郵件帳戶設定。
    2. 帳號部份使用者多打了「@」後面的內容。
    3. 使用者未勾選「我的SMTP伺服器需要驗證」。
    4. 使用者未取消勾選「接收收件」。

FAQ選項： [] 已存在FAQ　 [] 已建立FAQ　 [x] 可能以後不會發生


當日編號：05
設備卡號：895020
聯絡時間：15:30
申請單位：研教組
申請人(分機)：董先生(#5487)
服務性質： [] 到場處理    [x] 電話線上處理(含遠端處理)
服務類別： [] 硬體　 [] 軟體　 [] 網路　 [x] 郵件　 [] 重灌　 [] 中毒　 [] 無線　 [] 諮詢　 [] 印表機 　 [] 其他
處理結果： [x] 已完成　 [] 未完成
服務滿意度： [] 1  [] 2  [] 3  [] 4  [x] 5  
服務時間：120 分
作業系統：
問題簡述：
    1. 大宗郵件寄出後會收到收件人無法收件的郵件。

解決方法：
    1. 檢查大宗郵件帳戶設定。
    2. 帳號部份使用者多打了「@」後面的內容。
    3. 使用者未勾選「我的SMTP伺服器需要驗證」。
    4. 使用者未取消勾選「接收收件」。

FAQ選項： [] 已存在FAQ　 [] 已建立FAQ　 [x] 可能以後不會發生
            </textarea>
                    </div>
                </div>
                <div class="col-md-4">

                    <div class="form-froup mb-3">
                        <label for="name">TA</label>
                        <select class="form-control" id="name"></select>
                    </div>
                    <div class="form-froup mb-3">
                        <button class="btn btn-secondary mb-3" type="button" id="clearAndPaste">清除並貼上</button>
                        <button class="btn btn-secondary mb-3" type="button" id="clear">清除</button>
                        <button class="btn btn-secondary mb-3" type="button" id="select">全選</button>
                        <button class="btn btn-secondary mb-3" type="reset">重置範例</button>
                        <button class="btn btn-primary mb-3" type="submit">轉換並複製</button>
                    </div>
                    <div class="form-froup mb-3">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">提示訊息</h5>
                                <div class="card-text" id="msg">
                                    請將 Evernote 內容複製並貼上於下方文字方塊。
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </form>
    </div>

    <footer class="footer mt-auto py-3">
        <div class="container">
            <span class="text-muted">&copy; 2021 XSTAR STUDIO</span>
            <a href="https://github.com/yc5/ccta">Github</a>
        </div>
    </footer>

    <script>
        var catgoryTitles = ["硬體", "軟體", "網路", "郵件", "重灌", "中毒", "諮詢", "其他"]
        var taNames = ["以誠", "君桓", "亭臻", "凱麟", "奕嫣"]
        window.onload = () => {
            shuffle(taNames)
            taNames.forEach(e => {
                var itemSelect = document.createElement("option")
                itemSelect.text = e
                document.getElementById("name").appendChild(itemSelect)

            })
        }
        document.forms[0].addEventListener("submit", (e) => {
            e.preventDefault()

            var times = document.forms[0].a.value.matchAll(/服務時間：(\d+).+/g)
            var departments = document.forms[0].a.value.matchAll(/申請單位：(.+)/g)
            var catgories = document.forms[0].a.value.matchAll(/服務類別：[^x]+\[x\]\s(..)[^x]+\n/g)
            var transfers = document.forms[0].a.value.matchAll(/\d\.\s(.+\(僅有.+同仁有此權限，TA無法協助處理。\))/g)
            var output = ""


            times = [...times]
            departments = [...departments]
            catgories = [...catgories]
            transfers = [...transfers]

            if (times.length >= 1
                && times.length == departments.length
                && departments.length == catgories.length) {
                output += "---\n"
                output += "#### "
                output += new Date().toJSON().slice(5, 10).replace(/-/g, '/')
                output += " AM PM\n"
                output += "- TA：" + document.getElementById("name").value + "\n"
                output += "- 防禦率(S/T)\n"
                output += "    - 總服務案件數(T)：" + times.length + "\n"
                output += "    - 自行解決案件數(S)：" + (times.length - transfers.length) + "\n"
                output += "    - 轉介其他單位案件數(F=T-S)：" + transfers.length + "\n"
                for (let i = 0; i < transfers.length; i++) {
                    output += "        - " + transfers[i][1] + "\n"
                }
                output += "- 總服務時間(mins.)：\n\n"
                output += "|單位|總時間|硬體|軟體|網路|郵件|重灌|中毒|諮詢|其他|\n"
                output += "|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|\n"
                for (let i = 0; i < departments.length; i++) {
                    output += "| " + departments[i][1] + " |"
                    output += "\t" + times[i][1] + "\t|"
                    for (let j = 0; j < catgoryTitles.length; j++) {
                        // 如果遇到打 x 的類別就把服務時間加入
                        if (catgoryTitles[j].match(catgories[i][1])) {
                            output += "\t" + times[i][1] + "\t|"
                        } else {
                            output += "\t|"
                        }
                    }
                    output += "\n"
                }
                output += "\n"
                output += "- 用戶申訴事項：無。\n"
                output += "- 建議：無\n"
                output += "\n"

                output += "---"
                // console.log(departments);
                document.forms[0].a.value = output

                document.querySelector("textarea").select();
                document.execCommand("copy");
                document.getElementById("msg").innerText = "轉換完成，並已複製到剪貼簿。"
            } else {
                alert("Evernote 格式有誤。")
            }




            /* generation 1 - outdated */
            // document.forms[0].a.value = document.forms[0].a.value.replaceAll(/FAQ選項：.+\n/g, "---")
            // document.forms[0].a.value = document.forms[0].a.value.replaceAll(/服務滿意度：.+\n服務時間：.+\n/g, "")
            // document.forms[0].a.value = document.forms[0].a.value.replaceAll("[x]", "[✔]")

        })

        document.getElementById("clear").addEventListener("click", (e) => {
            document.forms[0].a.value = ""
        })
        document.getElementById("select").addEventListener("click", (e) => {
            document.querySelector("textarea").select();
        })
        document.getElementById("clearAndPaste").addEventListener("click", (e) => {
            console.log(!navigator.clipboard);
            if (!navigator.clipboard) {
                alert("瀏覽器不支援「navigator.clipboard」功能。")
            } else {
                if (!navigator.clipboard.readText) {
                    alert("瀏覽器不支援「貼上」功能。")
                } else {
                    navigator.clipboard.readText().then(clipText => {
                        document.forms[0].a.value = clipText
                    });
                }
            }
        })

        // document.querySelector("textarea").addEventListener("click", function () {
        //     this.select();
        //     document.getElementById("msg").innerText = "提示訊息：請貼上 Evernote 格式，並按下轉換。"
        // });

        // https://stackoverflow.com/questions/2450954/how-to-randomize-shuffle-a-javascript-array
        function shuffle(array) {
            let currentIndex = array.length, randomIndex;

            // While there remain elements to shuffle...
            while (currentIndex != 0) {

                // Pick a remaining element...
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;

                // And swap it with the current element.
                [array[currentIndex], array[randomIndex]] = [
                    array[randomIndex], array[currentIndex]];
            }

            return array;
        }
    </script>
</body>

</html>